var Hashtable=function(){function t(e){var n;if("string"==typeof e)return e;if(typeof e.hashCode==o)return"string"==typeof(n=e.hashCode())?n:t(n);if(typeof e.toString==o)return e.toString();try{return String(e)}catch(t){return Object.prototype.toString.call(e)}}function e(t,e){return t.equals(e)}function n(t,e){return typeof e.equals==o?e.equals(t):t===e}function r(t){return function(e){if(null===e)throw new Error("null is not a valid "+t);if(void 0===e)throw new Error(t+" must not be undefined")}}function a(t,e,n,r){this[0]=t,this.entries=[],this.addEntry(e,n),null!==r&&(this.getEqualityFunction=function(){return r})}function l(t){return function(e){for(var n,r=this.entries.length,a=this.getEqualityFunction(e);r--;)if(a(e,(n=this.entries[r])[0]))switch(t){case f:return!0;case g:return n;case d:return[r,n[1]]}return!1}}function i(t){return function(e){for(var n=e.length,r=0,a=this.entries.length;r<a;++r)e[n+r]=this.entries[r][t]}}function s(t,e){var n=t[e];return n&&n instanceof a?n:null}var o="function",u=typeof Array.prototype.splice==o?function(t,e){t.splice(e,1)}:function(t,e){var n,r,a;if(e===t.length-1)t.length=e;else for(n=t.slice(e+1),t.length=e,r=0,a=n.length;r<a;++r)t[e+r]=n[r]},c=r("key"),h=r("value"),f=0,g=1,d=2;return a.prototype={getEqualityFunction:function(t){return typeof t.equals==o?e:n},getEntryForKey:l(g),getEntryAndIndexForKey:l(d),removeEntryForKey:function(t){var e=this.getEntryAndIndexForKey(t);return e?(u(this.entries,e[0]),e[1]):null},addEntry:function(t,e){this.entries[this.entries.length]=[t,e]},keys:i(0),values:i(1),getEntries:function(t){for(var e=t.length,n=0,r=this.entries.length;n<r;++n)t[e+n]=this.entries[n].slice(0)},containsKey:l(f),containsValue:function(t){for(var e=this.entries.length;e--;)if(t===this.entries[e][1])return!0;return!1}},function e(n,r){var l=this,i=[],f={},g=typeof n==o?n:t,d=typeof r==o?r:null;this.put=function(t,e){c(t),h(e);var n,r,l=g(t),o=null;return(n=s(f,l))?(r=n.getEntryForKey(t))?(o=r[1],r[1]=e):n.addEntry(t,e):(n=new a(l,t,e,d),i[i.length]=n,f[l]=n),o},this.get=function(t){c(t);var e=g(t),n=s(f,e);if(n){var r=n.getEntryForKey(t);if(r)return r[1]}return null},this.containsKey=function(t){c(t);var e=g(t),n=s(f,e);return!!n&&n.containsKey(t)},this.containsValue=function(t){h(t);for(var e=i.length;e--;)if(i[e].containsValue(t))return!0;return!1},this.clear=function(){i.length=0,f={}},this.isEmpty=function(){return!i.length};var p=function(t){return function(){for(var e=[],n=i.length;n--;)i[n][t](e);return e}};this.keys=p("keys"),this.values=p("values"),this.entries=p("getEntries"),this.remove=function(t){c(t);var e,n=g(t),r=null,a=s(f,n);return a&&null!==(r=a.removeEntryForKey(t))&&(a.entries.length||(e=function(t,e){for(var n=t.length;n--;)if(e===t[n][0])return n;return null}(i,n),u(i,e),delete f[n])),r},this.size=function(){for(var t=0,e=i.length;e--;)t+=i[e].entries.length;return t},this.each=function(t){for(var e,n=l.entries(),r=n.length;r--;)t((e=n[r])[0],e[1])},this.putAll=function(t,e){for(var n,r,a,i,s=t.entries(),u=s.length,c=typeof e==o;u--;)r=(n=s[u])[0],a=n[1],c&&(i=l.get(r))&&(a=e(r,i,a)),l.put(r,a)},this.clone=function(){var t=new e(n,r);return t.putAll(l),t}}}();(function(t){function e(t,e){0==n.size()&&function(){for(var t=0;t<a.length;t++){localeGroup=a[t];for(var e=0;e<localeGroup.length;e++)n.put(localeGroup[e],t)}}();var l=".",i=",";0==e&&(-1!=t.indexOf("_")?t=t.split("_")[1].toLowerCase():-1!=t.indexOf("-")&&(t=t.split("-")[1].toLowerCase()));var s=n.get(t);if(s){var o=r[s];o&&(l=o[0],i=o[1])}return new function(t,e,n){this.dec=t,this.group=e,this.neg=n}(l,i,"-")}var n=new Hashtable,r=[[".",","],[",","."],[","," "],[".","'"]],a=[["ae","au","ca","cn","eg","gb","hk","il","in","jp","sk","th","tw","us"],["at","br","de","dk","es","gr","it","nl","pt","tr","vn"],["cz","fi","fr","ru","se","pl"],["ch"]];t.fn.formatNumber=function(e,n,r){return this.each(function(){var a;null==n&&(n=!0),null==r&&(r=!0),a=t(this).is(":input")?new String(t(this).val()):new String(t(this).text());var l=t.formatNumber(a,e);if(n&&(t(this).is(":input")?t(this).val(l):t(this).text(l)),r)return l})},t.formatNumber=function(n,r){for(var a=e((r=t.extend({},t.fn.formatNumber.defaults,r)).locale.toLowerCase(),r.isFullLocale),l=(a.dec,a.group,a.neg,""),i=!1,s=0;s<r.format.length;s++){if(-1!="0#-,.".indexOf(r.format.charAt(s))){if(0==s&&"-"==r.format.charAt(s)){i=!0;continue}break}l+=r.format.charAt(s)}var o="";for(s=r.format.length-1;s>=0&&-1=="0#-,.".indexOf(r.format.charAt(s));s--)o=r.format.charAt(s)+o;r.format=r.format.substring(l.length),r.format=r.format.substring(0,r.format.length-o.length);var u=new Number(n);return t._formatNumber(u,r,o,l,i)},t._formatNumber=function(n,r,a,l,i){var s=e((r=t.extend({},t.fn.formatNumber.defaults,r)).locale.toLowerCase(),r.isFullLocale),o=s.dec,u=s.group,c=s.neg,h=!1;if(isNaN(n)){if(1!=r.nanForceZero)return null;n=0,h=!0}"%"==a&&(n*=100);var f="";if(r.format.indexOf(".")>-1){var g=o,d=r.format.substring(r.format.lastIndexOf(".")+1);if(1==r.round)n=new Number(n.toFixed(d.length));else{var p=n.toString();p=p.substring(0,p.lastIndexOf(".")+d.length+1),n=new Number(p)}var m=new String((n%1).toFixed(d.length));m=m.substring(m.lastIndexOf(".")+1);for(var _=0;_<d.length;_++)if("#"!=d.charAt(_)||"0"==m.charAt(_)){if("#"==d.charAt(_)&&"0"==m.charAt(_)){if(m.substring(_).match("[1-9]")){g+=m.charAt(_);continue}break}"0"==d.charAt(_)&&(g+=m.charAt(_))}else g+=m.charAt(_);f+=g}else n=Math.round(n);var v=Math.floor(n);n<0&&(v=Math.ceil(n));var y="";y=-1==r.format.indexOf(".")?r.format:r.format.substring(0,r.format.indexOf("."));var C="";if(0!=v||"#"!=y.substr(y.length-1)||h){var b=new String(Math.abs(v)),O=9999;-1!=y.lastIndexOf(",")&&(O=y.length-y.lastIndexOf(",")-1);var P=0;for(_=b.length-1;_>-1;_--)C=b.charAt(_)+C,++P==O&&0!=_&&(C=u+C,P=0);if(y.length>C.length){var k=y.indexOf("0");if(-1!=k)for(var w=y.length-k,x=y.length-C.length-1;C.length<w;){var $=y.charAt(x);","==$&&($=u),C=$+C,x--}}}return!C&&-1!==y.indexOf("0",y.length-1)&&(C="0"),f=C+f,n<0&&i&&l.length>0?l=c+l:n<0&&(f=c+f),r.decimalSeparatorAlwaysShown||f.lastIndexOf(o)==f.length-1&&(f=f.substring(0,f.length-1)),f=l+f+a},t.fn.parseNumber=function(e,n,r){var a;null==n&&(n=!0),null==r&&(r=!0),a=t(this).is(":input")?new String(t(this).val()):new String(t(this).text());var l=t.parseNumber(a,e);if(l&&(n&&(t(this).is(":input")?t(this).val(l.toString()):t(this).text(l.toString())),r))return l},t.parseNumber=function(n,r){for(var a=e((r=t.extend({},t.fn.parseNumber.defaults,r)).locale.toLowerCase(),r.isFullLocale),l=a.dec,i=a.group,s=a.neg;n.indexOf(i)>-1;)n=n.replace(i,"");var o="",u=!1;"%"!=(n=n.replace(l,".").replace(s,"-")).charAt(n.length-1)&&1!=r.isPercentage||(u=!0);for(var c=0;c<n.length;c++)"1234567890.-".indexOf(n.charAt(c))>-1&&(o+=n.charAt(c));var h=new Number(o);if(u){h/=100;var f=o.indexOf(".");if(-1!=f){var g=o.length-f-1;h=h.toFixed(g+2)}else h=h.toFixed(o.length-1)}return h},t.fn.parseNumber.defaults={locale:"us",decimalSeparatorAlwaysShown:!1,isPercentage:!1,isFullLocale:!1},t.fn.formatNumber.defaults={format:"#,###.00",locale:"us",decimalSeparatorAlwaysShown:!1,nanForceZero:!0,round:!0,isFullLocale:!1},Number.prototype.toFixed=function(e){return t._roundNumber(this,e)},t._roundNumber=function(t,e){var n=Math.pow(10,e||0),r=String(Math.round(t*n)/n);if(e>0){var a=r.indexOf(".");for(-1==a?(r+=".",a=0):a=r.length-(a+1);a<e;)r+="0",a++}return r}})(jQuery),function(){"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),$(document).ready(function(){return OPC.init()}),jQuery.fn.center=function(){return this.css("position","absolute"),this.css("top",($(window).height()-this.outerHeight())/2+$(window).scrollTop()+"px"),this.css("left",($(window).width()-this.outerWidth())/2+$(window).scrollLeft()+"px"),this},window.OPC={version:"2.5.1",debug:!0,debug_refresh:!1,tags:{},elems:[],interval:1e3,callback_id:0,cache:{},auto_start:!1,token:"",data_index:null,isfile:document.location.protocol&&document.location.protocol.indexOf("file")>=0,serverURL:"http://localhost:58725",rndstr:function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},log:function(){var t;return!(!OPC.debug||"undefined"==typeof console||null===console||null==console.log)&&((t=Array.prototype.slice.call(arguments)).splice(0,0,"OPC.log"),console.log(t),!0)},log_err:function(t,e){var n;return n=null!=e.stack?e.stack:"",t=null==t?"<<ERROR>>":"<< "+t+" >>",OPC.log(t+"\n===\n"+e.message+"\n===\n"+n),!0},init:function(t){var e,n,r,a,l,i,s,o,u;if(OPC.cbpre=OPC.rndstr(6),this.config=null,this.toggle_refresh(!1),null==this.config&&(this.config=window.OPC_config),null==this.config&&(this.config={}),OPC.tags={},this.interval=null!=this.config.interval?this.config.interval:this.interval,this.debug=null!=this.config.debug?this.config.debug:this.debug,this.debug_refresh=null!=this.config.debug_refresh?this.config.debug_refresh:this.debug_refresh,this.auto_start=null!=this.config.auto_start?this.config.auto_start:this.auto_start,this.token=null!=this.config.token?this.config.token:this.token,this.serverURL=null!=this.config.serverURL?this.config.serverURL:this.serverURL,this.locale=null!=this.config.locale?this.config.locale:"us",this.trend_bindings=null!=this.config.trend_bindings?this.config.trend_bindings:[],this.alarm_bindings=null!=this.config.alarm_bindings?this.config.alarm_bindings:[],this.refresh_callback=this.config.refresh_callback,this.tag_prefix=null!=this.config.tag_prefix?this.config.tag_prefix:"",this.max_tags_per_msg=null!=this.config.max_tags_per_msg?this.config.max_tags_per_msg:0,this.reload_interval=null!=this.config.reload_interval?this.config.reload_interval:0,this.root_elem=null!=this.config.root_elem?$(this.config.root_elem):$("body"),OPC.data_index=null,OPC.serverURL.lastIndexOf("/")==OPC.serverURL.length-1&&(OPC.serverURL=OPC.serverURL.substring(0,OPC.serverURL.length-1)),null!=this.config.watch_tags&&this.config.watch_tags.length>0)for(this.config.tags=null,null==this.config.tags&&(this.config.tags=[]),a=0,i=(o=this.config.watch_tags).length;a<i;a++){r=o[a],n=OPC.parse_tag_prop(r);for(var c=null,h=0;h<this.config.tags.length;h++){var f=this.config.tags[h];if(n[0]==f.name){c=f;break}}if(c){var g=null;for(h=0;h<c.props.length;h++){var d=c.props[h];if(n[1]==d.name){g=d;break}}g||c.props.push({name:n[1]})}else this.config.tags.push({name:n[0],props:[{name:n[1]}]})}if(null!=this.config.tags&&this.config.tags.length>0){if(null!=this.tag_prefix)for(l=0,s=(u=this.config.tags).length;l<s;l++)(e=u[l]).name=e.ignore_prefix?e.name:""+this.tag_prefix+e.name;this.add_tags(this.config.tags),this.log("initilization, config.tags: "+this.config.tags.length)}return null!=document.location&&"ms-appx:"===document.location.protocol&&(this.app_url=document.location.protocol+"//"+document.location.host,this.iframe_id=null!=this.config.iframe_id?this.config.iframe_id:"opc_rt_iframe",$(document).ready(function(){var t,e;return 0===(e=$("#"+OPC.iframe_id)).length?$("body").append($("<iframe id='"+OPC.iframe_id+"' style='position:absolute;top:-1000px;left:-1000px;width:0;height:0;background-color:transparent;'></iframe>")):($(e).css("position","absolute").css("top","-1000px").css("left","-1000px"),$(e).width(0).height(0).css("background-color","transparent")),$("#"+OPC.iframe_id).load(function(){var t,e;return t=document.getElementById(""+OPC.iframe_id),e={type:"init",parent_url:OPC.app_url},t.contentWindow.postMessage(JSON.stringify(e),"*"),!0}),$(e).attr("src","ms-appx-web:///"+OPC.iframe_id+".html"),t=null!=window.addEventListener?"addEventListener":"attachEvent",(0,window[t])("attachEvent"===t?"onmessage":"message",function(t){var e;if(t.data&&(e=JSON.parse(t.data)).tags)return OPC.refresh_data(e,e.cid)},!1),!0})),OPC.Alarm.init_alarms(),this.scan_document(),this},restart_refresh:function(){return(this.auto_start||null!=this.token&&""!==this.token)&&this.toggle_refresh(!0),!0},scan_document:function(){var t,e,n,r,a,l,i,s;for(t in this.toggle_refresh(!1),l=[],r=[],a=[],!1,n="",OPC.Elem.val_ops)e="opc-tag-"+t,$("["+e+"]",OPC.root_elem).each(function(i,s){var o,u,c,h,f,g,d,p,m;try{if(n="#"+$(s).attr("id"),null!=(f=$.parseJSON($(s).attr(e))).tag){if(2===(h=OPC.parse_tag_prop(f.tag)).length)return u={name:o=f.ignore_prefix?h[0]:""+OPC.tag_prefix+h[0],props:[{name:h[1],elems:[{sel:""+n,acts:[{type:t,config:f.config}]}]}],ignore_prefix:f.ignore_prefix},"set"===t?(a.push(u),(c=$.extend(!0,{},u)).props=[{name:[h[1]]}],l.push(c)):l.push(u),!0}else if(null!=f.type&&("comp"===f.type||"group"===f.type)){if(u={type:t,sel:""+n,vals:[],ignore_prefix:f.ignore_prefix},"group"===f.type&&null!=f.group&&f.group.length>0)for(u.bad_q=f.bad_q,u.all_f=f.all_f,d=0,p=(m=f.group).length;d<p;d++)null!=(g=m[d]).tag&&(2===(h=OPC.parse_tag_prop(g.tag)).length&&(o=f.ignore_prefix?h[0]:""+OPC.tag_prefix+h[0],u.vals.push({tag:o,prop:h[1],config:g.config})));else"comp"===f.type&&null!=f.tag1&&null!=f.tag2&&null!=f.op&&u.vals.push({tag1:f.tag1,tag2:f.tag2,op:f.op,config:f.config});if(u.vals.length>0)return r.push(u),!0}}catch(e){return OPC.log_err("Error parsing tag ["+t+"] on ["+n+"]",e)}});for(i in this.add_tags(l),this.add_elems(r),this.bind_sets(a),s=0,OPC.tags)s++;return OPC.log("scanning done. total tags: "+s),this.restart_refresh(),!0},stop_interval:function(t){return null!=OPC.intervals&&null!=OPC.intervals[t]&&(OPC.intervals[t]=null),!0},clear_interval:function(t){return null!=OPC.active_interval[t]&&(clearTimeout(OPC.active_interval[t]),OPC.active_interval[t]=null),!0},run_interval:function(t,e,n){var r,a,l;return null==OPC.intervals&&(OPC.intervals={}),null==OPC.active_interval&&(OPC.active_interval={}),OPC.intervals[n]=1,a=e,l=n,(r=function(){if(null!=OPC.intervals&&null!=OPC.intervals[l]){OPC.clear_interval(l),OPC.active_interval[l]=setTimeout(r,a);try{t.call(null)}catch(t){}}return!0})(e,n)},is_refreshing:function(){return null!=OPC.intervals&&OPC.intervals.timer},toggle_refresh:function(t){return t?(t=null!=OPC.interval&&OPC.interval>0&&(null!=t?t:!OPC.is_refreshing))||OPC.is_refreshing?(t?(OPC.refresh(),OPC.run_interval(OPC.refresh,OPC.interval,"timer"),null!=OPC.reload_interval&&OPC.reload_interval>0&&setTimeout(function(){return document.location.reload()},6e4*OPC.reload_interval)):OPC.stop_interval("timer"),!0):void 0:(OPC.stop_interval("timer"),!1)},parse_tag_prop:function(t,e){var n,r,a,l,i,s,o;for(t=null!=e?t+"."+e:t,n=s=0,o=(l=$.trim(t).split(".")).length;s<o;n=++s)r=l[n],l[n]=$.trim(r);return l.length>2&&(i=(a=l.slice(0)).splice(l.length-1,1),l=[a.join("."),i[0]]),l},get_tag_json:function(t,e,n){var r,a,l,i,s,o;for(i in o=OPC.parse_tag_prop(t,e),void 0===n&&2===o.length&&(t=o[0],e=o[1]),s={tags:[]},OPC.tags)if(null==t||i===t){for(l in a={name:i,props:[]},OPC.tags[i].props)null!=e&&l!==e||(r={name:l,val:n},a.props.push(r));s.tags.push(a)}return s},refresh_data:function(t,e){return OPC.debug_refresh&&OPC.log(t),OPC.read_tags(t.tags,e),OPC.set_elems(),OPC.refresh_callback&&OPC.refresh_callback(t,e),!0},refresh:function(){var t,e,n,r,a,l,i,s,o,u;if(OPC.Trend.refresh_data(),OPC.Alarm.refresh_data(),r=[],n=[],u=(e=OPC.get_tag_json()).tags,!OPC.isfile&&null==OPC.data_index){var c={tags:[]};OPC.data_index="pending";for(var h=0;h<u.length;h++)for(var f=u[h],g=0;g<f.props.length;g++)c.tags.push(f.name+"."+f.props[g].name);if(0==c.tags.length)return OPC.data_index=null,!0;var d={data:c,error:null,success:null,url:"/getdataindex?token="+OPC.token,error:function(t){return OPC.data_index=null,OPC.log("DATA INDEX ERROR: "+t.status+", "+t.statusText),!0},success:function(t){OPC.data_index=t.message}};return OPC.post(d),!0}if(!OPC.isfile&&"pending"==OPC.data_index)return!0;if(!OPC.isfile){var p=OPC.cbpre+"_"+OPC.callback_id++;return $.ajax({type:"GET",url:OPC.serverURL+"/OPCREST/gettagdata?token="+OPC.token+"&dataindex="+OPC.data_index+"&callback="+p,contentType:"text/plain",success:function(t){OPC.refresh_data(t,p),null!=OPC.refresh_callback&&OPC.refresh_callback(t)},error:function(t){OPC.data_index=null},timeout:OPC.interval+1e3}),!0}for(h=l=0,s=u.length;l<s;h=++l)d=u[h],(n.length<OPC.max_tags_per_msg||0===OPC.max_tags_per_msg)&&(n.push(d),n.length===OPC.max_tags_per_msg&&h!==e.tags.length-1&&(r.push(n),n=[]));for(n.length>0&&r.push(n),i=0,o=r.length;i<o;i++)a=r[i],e.tags=a,e.status="OK",e.message="",t=OPC.callback_id++,OPC.get({url:"/getdata",data:e,cid:t,success:function(t){return function(e,n){return OPC.refresh_data(e,t),null!=OPC.refresh_callback&&OPC.refresh_callback(e),!0}}(t),error:function(t){return OPC.log("REFRESH ERROR: "+t.status+", "+t.statusText),!0}});return e=null,!0},get_trend_binding:function(t){return OPC.Trend.get_binding(t)},get_history_data:function(t,e,n){return OPC.Trend.get_history_data(t,e,n)},resume_trend_data:function(t){return OPC.Trend.resume_trend_data(t)},set_val:function(t,e,n){return OPC.set_value(t,e,n)},set_value:function(t,e,n){var r,a,l;return l=null!=n?OPC.parse_tag_prop(t,e):OPC.parse_tag_prop(t),void 0===n&&2===l.length&&(n=e,t=l[0],e=l[1]),(a=OPC.get_tag_json(t,e,n)).status="OK",a.message="",r=OPC.callback_id++,OPC.get({url:"/setdata",data:a,cid:r,success:function(t,e){return OPC.debug_refresh&&OPC.log(t),!0},error:function(t){return OPC.log("SET VALUE ERROR: "+t.status+", "+t.statusText)}}),!0},get_tag_props:function(t,e,n,r,a){t=t||"localhost",e=e||"",n=n||"";var l={token:OPC.token,networknode:t,livedatacloudnode:e,startinggroup:n,version:1},i=encodeURI(JSON.stringify(l));OPC.get_withcallbacks(OPC.serverURL+"/OPCREST/gettagsandproperties?message="+i+"&callback=cb",null,r,a)},get_withcallbacks:function(t,e,n,r){$.ajax({type:"GET",url:t,contentType:e||"application/json; charset=utf-8",success:n,error:r,timeout:5e3})},get_custom:function(t,e,n){OPC.get_withcallbacks(t,"text/plain",e,n)},get_customobject:function(t,e,n){OPC.get_custom(OPC.serverURL+"/OPCREST/getcustomobject?token="+OPC.token+"&key="+t,e,n)},clear_customobject:function(t,e,n){OPC.get_custom(OPC.serverURL+"/OPCREST/clearcustomobject?token="+OPC.token+"&key="+t,e,n)},set_customobject:function(t,e,n,r){$.ajax({type:"POST",url:OPC.serverURL+"/OPCREST/setcustomobject?token="+OPC.token+"&key="+t,dataType:"text",contentType:"text/plain",data:e,success:n,error:r,timeout:5e3,crossDomain:!0})},validate_token:function(t,e,n){t=t&&""!=t?t:OPC.token,$.ajax({type:"GET",url:OPC.serverURL+"/OPCREST/validatetoken?token="+t,dataType:"json",contentType:"application/json; charset=utf-8",success:e,error:n,timeout:5e3})},authenticate:function(t,e,n){var r;return OPC.auth_callback=n,OPC.toggle_refresh(!1),r=OPC.callback_id++,OPC.get({url:"/gettoken",data:{un:null!=t?t:"",pw:null!=e?e:""},cid:r,success:function(t,e){return OPC.token=t.message,OPC.debug_refresh&&OPC.log(t),null!=OPC.token&&""!==OPC.token&&OPC.toggle_refresh(!0),OPC.auth_callback&&OPC.auth_callback(OPC.token),!0},error:function(t){return OPC.auth_callback&&OPC.auth_callback("ERROR: "+t.statusText),OPC.log("GET TOKEN ERROR: "+t.status+", "+t.statusText),OPC.token="AUTH FAILURE"}}),!0},clean_callback:function(t){if(window[OPC.cbpre+"_"+t]){window[OPC.cbpre+"_"+t]=null;try{delete window[OPC.cbpre+"_"+t]}catch(t){}}return!0},get:function(t){var e,n,r,a,l=OPC.interval+1e3;return t.url&&(t.url.indexOf("/getalarmdata")>=0||t.url.indexOf("/gettrenddata")>=0)&&(l=3e4),"application/json; charset=utf-8",t.data.token=OPC.token,e={message:r="string"==typeof t.data?t.data:JSON.stringify(t.data)},OPC.app_url&&""!==OPC.app_url?(r={type:"json",data:e,url:OPC.serverURL+"/OPCREST"+t.url,cid:OPC.callback_id++},null!=(n=document.getElementById(""+OPC.iframe_id))&&(n.contentWindow.postMessage(JSON.stringify(r),"*"),r=null)):$.ajax({url:OPC.serverURL+"/OPCREST"+t.url,dataType:null!=t.dataType?t.dataType:"jsonp",contentType:null!=t.contentType?t.contentType:"application/json; charset=utf-8",data:e,jsonpCallback:OPC.cbpre+"_"+t.cid,success:t.success,error:t.error,timeout:l,complete:(a=t.cid,function(t,e){return OPC.clean_callback(a)})}),!0},post:function(t){$.ajax({type:"POST",url:OPC.serverURL+"/OPCREST"+t.url+"&callback="+OPC.cbpre+"_"+OPC.callback_id++,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t.data),success:t.success,error:t.error,timeout:3e4,crossDomain:!0})},read_tags:function(t,e){var n,r,a,l,i,s,o;for(e=e||"-",a=0,i=t.length;a<i;a++)for(l=0,s=(o=(r=t[a]).props).length;l<s;l++)n=o[l],OPC.debug_refresh&&OPC.log("cid:"+e+" "+r.name+"."+n.name+": "+n.val+" datatype:"+n.datatype),OPC.read_tag(r.name,n.name,n.val,n.qual,n.datatype,e);return!0},read_tag:function(t,e,n,r,a,l){var i;if(null!=(i=this.tags[t]))return i.read_prop(e,n,r,a,l)},set_elems:function(){var t,e;for(t in OPC.elems)(e=OPC.elems[t]).set_groups(),e.set_comps();return!0},add_tags:function(t){var e,n,r,a,l;if(null==t||0===t.length)return!1;for(a=0,l=t.length;a<l;a++)null!=(n=t[a]).name&&null!=n.props&&(e=n.name,null!=(r=this.tags[e])?r.add_props(n.props):this.tags[e]=new OPC.Tag({name:e,props:n.props}));return!0},get_tag_config:function(t,e){var n,r;return n={name:"",props:[{name:"",elems:[]}]},2===(r=OPC.parse_tag_prop(t,e)).length?(n.name=r[0],n.props[0].name=r[1]):null!=t&&null!=e&&(n.name=t,n.props[0].name=e),n},ubind_sets:function(t){var e,n,r,a,l,i,s;for(s=[],l=0,i=t.length;l<i;l++)(a=t[l]).name,s.push(function(){var t,l,i,s;for(s=[],t=0,l=(i=a.props).length;t<l;t++)n=i[t],n.name,s.push(function(){var t,a,l,i;for(i=[],t=0,a=(l=n.elems).length;t<a;t++)e=l[t],null!=(r=e.sel)&&0!==$(r,OPC.root_elem).length&&i.push($(r,OPC.root_elem).unbind(".OPCEvents"));return i}());return s}());return s},bind_sets:function(t){var e,n,r,a,l,i,s,o,u,c,h,f,g,d,p,m,_,v;if(null==t||0===t.length)return!1;for(OPC.ubind_sets(t),o=0,f=t.length;o<f;o++)for(i=(s=t[o]).name,u=0,g=(m=s.props).length;u<g;u++)for(r=(a=m[u]).name,c=0,d=(_=a.elems).length;c<d;c++)if(n=_[c],null!=(l=n.sel)&&0!==$(l,OPC.root_elem).length)for(h=0,p=(v=n.acts).length;h<p;h++)if(null!=(e=v[h]).config&&null!=e.config.evt&&null!=e.config.set)switch(e.config.evt){case"click":!function(t,e,n){var r;r=function(){return OPC.Elem.val_ops.set(t,e,n,$(this)),!0},$(l,OPC.root_elem).bind("click.OPCEvents",r)}(i,r,e.config);break;case"change":!function(t,e,n,r){var a,i=l;a=function(){return OPC.Elem.val_ops.set(t,e,n,$(i)),!0},$(i,OPC.root_elem).bind("change.OPCEvents",a)}(i,r,e.config)}return!0},add_elems:function(t){var e,n,r,a,l,i,s,o,u,c;if(null==t||0===t.length)return!1;for(a=[],i=0,o=t.length;i<o;i++){if(r=t[i],n=this.elems[r.sel],e={sel:r.sel,bad_q:r.bad_q,all_f:r.all_f},null!=r.vals&&r.vals.length>0){for(e.vals={},e.vals[r.type]=r.vals,s=0,u=(c=r.vals).length;s<u;s++)null!=(l=c[s]).tag1?(a.push(this.get_tag_config(l.tag1)),a.push(this.get_tag_config(l.tag2))):a.push(this.get_tag_config(l.tag,l.prop));null!=n?n.add_groups(e):this.elems[r.sel]=new OPC.Elem(e)}a.length>0&&this.add_tags(a)}return!0},set_cache:function(t,e,n){var r;return null==(r=OPC.cache[t])&&(r={},OPC.cache[t]=r),r[e]=n,n},get_cache:function(t,e){var n;return null==(n=OPC.cache[t])&&(n={},OPC.cache[t]=n),n[e]},get_value:function(t,e){var n,r,a;return null==t?null:(2===(a=OPC.parse_tag_prop(t,e)).length&&(t=a[0],e=a[1]),null!=(n=null!=(r=OPC.tags[$.trim(t)])?r.props[$.trim(e)]:null)?n.val:null)},set_styles:function(t,e,n){var r,a,l,i,s,o,u;for(o=0,u=(i=n.split(";")).length;o<u;o++)l=i[o],""!==(l=$.trim(l))&&(r=(a=l.split(":"))[0],s=a.length>2?a.slice(1).join(":"):a[1],OPC.set_style(t,r,e,s));return OPC.build_style(t),!0},set_style:function(t,e,n,r,a){var l,i,s,o,u;for(i=s=0,o=(u=(l=OPC.get_styles(t,e)).vals).length;s<o;i=++s)if(u[i].src===n){l.vals.splice(i,1);break}return l.vals.push({src:n,val:r}),a&&OPC.build_style(t),!0},get_styles:function(t,e,n){var r;return null==(r=OPC.get_cache(t,e))&&(r={original:null!=n?n:$("#"+t,OPC.root_elem).css(e),vals:[]},OPC.set_cache(t,e,r)),r},remove_styles:function(t,e){var n,r,a,l,i,s,o,u;if(null==(n=OPC.cache[t]))return!1;for(l in n)if(null!=(r=n[l]).vals&&r.vals.length>0){for(a=[],s=0,o=(u=r.vals).length;s<o;s++)(i=u[s]).src!==e&&a.push(i);r.vals=a}return OPC.build_style(t),!0},build_style:function(t){var e,n,r,a,l;if(n=$("#"+t,OPC.root_elem),null!=(r=OPC.cache[t]))for(a in r)l=(e=r[a]).original,null!=e.vals&&e.vals.length>0&&(l=e.vals[e.vals.length-1].val),n.css(a,l);return!0}},OPC.Util=function(){function t(){}return t.padleft=function(t,e,n){var r;return(r=new Array(n+1).join(e)+t).length>n&&(r=r.slice(r.length-n)),r},t.formatDate=function(t,e){var n,r,a,l,i,s,o,u;return u=t.getFullYear(),(s=OPC.Util.padleft(t.getMonth()+1,"0",2))+"/"+(r=OPC.Util.padleft(t.getDate(),"0",2))+"/"+u,l=t.getHours(),i=OPC.Util.padleft(t.getMinutes(),"0",2),o=OPC.Util.padleft(t.getSeconds(),"0",2),n=l>=12?"pm":"am",(a=l)>12?a-=12:0===a&&(a=12),(a=OPC.Util.padleft(a,"0",2))+":"+i+":"+o+" "+n,e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("yyyy",""+u)).replace("yy",(""+u).slice(2))).replace("mm",s)).replace("dd",r)).replace("HH",l)).replace("hh",a)).replace("MM",i)).replace("ss",o)).replace("aa",""+n)},t}(),OPC.Tag=function(){function t(t){this.name=t.name,this.props={},null!=t.props&&t.props.length>0&&this.add_props(t.props)}return t.prototype.add_props=function(t){var e,n,r,a;for(r=0,a=t.length;r<a;r++)null!=(e=t[r]).name&&(null!=(n=this.props[e.name])?n.add_elems(e.elems):this.props[e.name]=new OPC.Prop({name:e.name,elems:e.elems,tag:this}));return!0},t.prototype.read_prop=function(t,e,n,r,a){var l;return null!=(l=this.props[t])&&l.read_val(e,n,r,a)},t}(),OPC.Prop=function(){function t(t){this.name=t.name,this.elems={},this.val="",this.cid=-1,this.quality=!0,this.data_type="",this.tag=null!=t.tag?t.tag:null,null!=t.elems&&t.elems.length>0&&this.add_elems(t.elems)}return t.prototype.add_elems=function(t){var e,n,r,a;if(null!=t){for(r=0,a=t.length;r<a;r++)null!=(n=t[r]).ref&&(n.sel="#"+$(n.ref).attr("id")),null!=n.sel&&"#"!==n.sel&&null!=n.acts&&(null!=(e=this.elems[n.sel])?e.add_acts(n.acts):(e=new OPC.Elem({sel:n.sel,acts:n.acts}),this.elems[n.sel]=e));return!0}},t.prototype.read_val=function(t,e,n,r){var a,l;for(a in l=null==t?null:t.toString(),this.val=l,this.quality=null!=t&&""!==t,this.data_type=n,this.cid=r,this.elems)this.elems[a].read_val(t,n,this.quality);return!0},t}(),OPC.Elem=function(){function t(t){this.ignore_prefix=t.ignore_prefix,this.sel=t.sel,this.add_acts(t.acts),this.add_groups(t)}return t.prototype.add_acts=function(t){var e,n,r;if(null==t||0===t.length)return!1;for(null==this.acts&&(this.acts=[]),n=0,r=t.length;n<r;n++)null!=(e=t[n])&&null!=e.type&&this.acts.push(e);return!0},t.prototype.add_groups=function(t){var e,n;if(null==t||null==t.vals||t.vals.length<1)return!1;for(n in null==this.groups&&(this.groups={}),t.vals)e={bad_q:t.bad_q,all_f:t.all_f,vals:t.vals[n]},this.groups[n]=e;return!0},t.prototype.add_comps=function(t){var e;if(null==t)return!1;for(e in null==this.comps&&(this.comps={}),t)this.comps[e]=t[e];return!0},t.prototype.read_val=function(t,e,n){var r,a,l,i,s,o,u,c;if((a=$(this.sel,OPC.root_elem)).length>0){for(i=0,o=(c=this.acts).length;i<o;i++)if(r=c[i],null!=(l=OPC.Elem.val_ops[r.type]))for(s=0,u=a.length;s<u;s++)l(r,a[s],t,e,n);return!0}return!1},t.prototype.set_groups=function(){var t,e,n,r,a,l,i,s,o,u,c;if(null==this.sel||0===$(this.sel,OPC.root_elem).length)return!1;for(n in $(this.sel,OPC.root_elem),this.groups){for(e=null,i=!1,a=!0,o=0,u=(c=(r=this.groups[n]).vals).length;o<u;o++)l=c[o],s=OPC.get_value(l.tag,l.prop),t=OPC.Elem.parseBool(s),null==r.bad_q||null!=s&&""!==s?(null!=l.tag&&t||null!=l.tag1&&null!=l.tag2&&null!=l.op&&this.test_comp(l.tag1,l.tag2,l.op))&&(e=null!=e?e:l.config,i=i||!0):a=!1,OPC.Elem.val_ops[n]({config:l.config},this.sel,!1);null!=r.bad_q&&OPC.Elem.val_ops[n]({config:r.bad_q},this.sel,!1),null!=r.all_f&&OPC.Elem.val_ops[n]({config:r.all_f},this.sel,!1),a?null!=r.all_f&&!i&&(e=r.all_f,i=!0):(e=r.bad_q,i=!0),OPC.Elem.val_ops[n]({config:e},this.sel,i)}return!0},t.prototype.test_comp=function(t,e,n){var r,a;return r=OPC.get_value(t),a=OPC.get_value(e),"="===n&&r===a||">"===n&&r>a||">="===n&&r>=a||"<"===n&&r<a||"<="===n&&r<=a||"!="===n&&r!==a},t.prototype.set_comps=function(){var t,e;if(null==this.sel||0===$(this.sel,OPC.root_elem).length)return!1;for(t in $(this.sel,OPC.root_elem),this.comps)e=this.comps[t],this.test_comp(e.tag1,e.tag2,e.op);return!0},t.val_ops={src:function(e,n,r,a,l){return t.set_attr($(n).attr("id"),"orig-src","src",e.config,r),!0},bkg:function(e,n,r,a,l){return t.set_styles(n,"bkg",e.config,r,"background-color"),!0},"bkg-fl":function(e,n,r,a,l){return t.flash(n,e,r,"background-color"),!0},fg:function(e,n,r,a,l){return t.set_styles(n,"fg",e.config,r,"color"),!0},"fg-fl":function(e,n,r,a,l){return t.flash(n,e,r,"color"),!0},brd:function(e,n,r,a,l){return t.set_styles(n,"brd",e.config,r,"border-color"),!0},"brd-fl":function(e,n,r,a,l){return t.flash(n,e,r,"border-color"),!0},val:function(e,n,r,a,l){return null!=r&&""!==r&&null!=e.config&&(null!=e.config.gain||null!=e.config.rate||null!=e.config.offset)&&(r=t.resolve_value(e.config,r).val),$(n).is(":focus")||$(n).val(t.format_data(r,a,e.config,l)),!0},txt:function(e,n,r,a,l){return $(n).empty(),null!=r&&""!==r&&null!=e.config&&(null!=e.config.gain||null!=e.config.rate||null!=e.config.offset)&&(r=t.resolve_value(e.config,r).val),$(n).html(t.format_data(r,a,e.config,l)),!0},tt:function(e,n,r,a,l){return $(n).attr("title",t.format_data(r,a,e.config,l)),!0},en:function(e,n,r,a,l){var i;return i=!0,null==r&&null!=e&&null!=e.config&&null!=e.config.bad_q?i=t.parseBool(e.config.bad_q):null!=r&&(i=t.parseBool(r),null!=e.config&&null!=e.config.trigger&&"on_false"===e.config.trigger&&(i=!i)),i?$(n).removeAttr("disabled"):$(n).attr("disabled","disabled"),!0},vis:function(e,n,r,a,l){var i,s;return s=!0,i=null!=e.config&&null!=e.config.rate?parseFloat(e.config.rate):100,null==r&&null!=e&&null!=e.config&&null!=e.config.bad_q?s=t.parseBool(e.config.bad_q):null!=r&&(s=t.parseBool(r),null!=e.config&&null!=e.config.trigger&&"on_false"===e.config.trigger&&(s=!s)),s?$(n).css("display","").animate({opacity:1},{duration:i,queue:!1}):$(n).animate({opacity:0},{duration:i,queue:!1,done:function(){return $(this).css("display","none")}}),!0},op:function(e,n,r,a,l){var i;return null!=(i=t.resolve_value(e.config,r))&&$(n).animate({opacity:i.val},{duration:i.rate,queue:!1}),!0},wd:function(e,n,r,a,l){var i;return null!=(i=t.resolve_value(e.config,r))&&$(n).animate({width:i.val},{duration:i.rate,queue:!1}),!0},ht:function(e,n,r,a,l){var i;return null!=(i=t.resolve_value(e.config,r))&&$(n).animate({height:i.val},{duration:i.rate,queue:!1}),!0},sx:function(e,n,r,a,l){var i,s;return s=t.resolve_value(e.config,r),i=OPC.get_styles($(n).attr("id"),"outerWidth",$(n).outerWidth()),null!=s&&$(n).animate({width:s.val*i.original+s.offset},{duration:s.rate,queue:!1}),!0},sy:function(e,n,r,a,l){var i,s;return s=t.resolve_value(e.config,r),i=OPC.get_styles($(n).attr("id"),"outerHeight",$(n).outerHeight()),null!=s&&$(n).animate({height:s.val*i.original+s.offset},{duration:s.rate,queue:!1}),!0},tx:function(e,n,r,a,l){var i;return null!=(i=t.resolve_value(e.config,r))&&($(n).css("position","absolute"),$(n).animate({left:i.val},{duration:i.rate,queue:!1})),!0},ty:function(e,n,r,a,l){var i;return null!=(i=t.resolve_value(e.config,r))&&($(n).css("position","absolute"),$(n).animate({top:i.val},{duration:i.rate,queue:!1})),!0},set:function(e,n,r,a){var l,i,s,o,u,c,h,f,g;switch(f=null,l="CANCEL",u="OK",null!=r.set_confirm_buttons&&"yesno"===r.set_confirm_buttons&&(l="NO",u="YES"),o=null!=r.set_confirm_msg?r.set_confirm_msg:"Save new value for "+e+"."+n+"?",h=null!=r.set_confirm_title?r.set_confirm_title:"Confirm Submission",i=t.parseBool(r.set_confirm),c=!1,g=r.validation,r.set){case"value":var d=r.set_src&&""!=r.set_src?r.set_src:$(a).attr("id");f=null,f=null!=r.set_value?r.set_value:null!=r.set_src?$("#"+d,OPC.root_elem).val():$(a).val();break;case"input":i=!0,c=!0,h=null!=r.set_confirm_title?h:"Enter a Value",f=null;break;case"toggle":f="toggle"}return i?(s={tag:e,prop:n,title:h,message:o,show_input:c,val:f,buttons:[{text:l},{text:u,click:OPC.set_val}],validation:g},new OPC.Modal(s)):null!=f&&OPC.set_val(e,n,f),!0},fn:function(e,n,r,a,l){return null!=r&&t.parseBool(r)&&null!=e.config&&null!=e.config.fn&&t.execute_fn(e.config.fn),!0},style:function(e,n,r,a,l){var i;return i=null!=e&&null!=e.config&&null!=e.config.style?e.config.style:null,null!=r&&t.set_attr($(n).attr("id"),"orig-style","style",i,r),!0},cls:function(e,n,r,a,l){var i;return i=null!=e&&null!=e.config&&null!=e.config.cls?e.config.cls:null,null!=r&&t.set_attr($(n).attr("id"),"orig-cls","class",i,r),!0}},t.resolve_value=function(t,e){var n,r,a,l;return l=null!=t&&null!=t.rate?parseFloat(t.rate):OPC.interval/5,r=null!=t&&null!=t.gain?parseFloat(t.gain):1,n=null!=t&&null!=t.formats&&null!=t.formats.bad_q?parseFloat(t.formats.bad_q):-1,a=null!=t&&null!=t.offset?parseFloat(t.offset):0,{val:e=null!=e?parseFloat(e)*r+a:-1!==n?n:e,rate:l,gain:r,offset:a,bad_q:n}},t.format_data=function(t,e,n,r){var a,l,i;if(null==n||null==n.formats)return t;if(null==t||!r&&null!=n.formats.bad_q)return n.formats.bad_q;switch(l=null!=n.formats.locale?n.formats.locale:OPC.locale,e){case"int":null!=n.formats.int&&(i=parseInt(t),t=$.formatNumber(i,{format:n.formats.int,locale:l}));break;case"float":null!=n.formats.float&&(i=parseFloat(t),t=$.formatNumber(i,{format:n.formats.float,locale:l}));break;case"boolean":(a=this.parseBool(t))&&null!=n.formats.bool_t?t=n.formats.bool_t:!a&&null!=n.formats.bool_f&&(t=n.formats.bool_f);break;case"datetime":null!=n.formats.date&&(t=new Date(t).toString(n.formats.date));break;case"string":return null!=n.formats.string?n.formats.string.replace("{0}",t):t}return null!=n.formats.string&&(t=n.formats.string.replace("{0}",t)),t},t.flash=function(t,e,n,r){var a,l,i,s,o,u,c=this;if(a=e.type,i=null!=e.config.rate?e.config.rate:200,o=null!=e.config.trigger?e.config.trigger:"on_true",u=this.parseBool(n),"trans"===o||(u||"on_true"!==o&&"trans_true"!==o)&&(!u||"on_false"!==o&&"trans_false"!==o))return null==$(t).attr(a)&&$(t).attr(a,0),l=parseInt($(t).attr(a)),null!=$(t).attr(a)&&(l=parseInt($(t).attr(a))+1,$(t).attr(a,l)),"on_true"!==o&&"on_false"!==o&&null!=e.config.repeat&&((s=parseInt(e.config.repeat))>0&&l>=2*s&&(l=-99)),l<0?($(t).removeAttr(a),OPC.remove_styles($(t).attr("id"),e.type),!1):(l%2!=0?this.set_styles(t,e.type,e.config,!0,r):OPC.remove_styles($(t).attr("id"),e.type),$(t).delay(i,a).queue(a,function(){return c.flash(t,e,n,r)}).dequeue(a));null!=$(t).attr(a)&&($(t).attr(a,-99),OPC.remove_styles($(t).attr("id"),e.type),$(t).dequeue(a))},t.execute_fn=function(t,e){var n,r,a,l,i,s;for(e=Array.prototype.slice.call(arguments).splice(1),n=window,r=(l=t.split(".")).pop(),a=i=0,s=l.length;i<s;a=++i)n=n[l[a]];return n[r].apply(window,e)},t.set_styles=function(t,e,n,r,a){var l;return null!=r&&null!=n&&(l=$(t).attr("id"),OPC.remove_styles(l,e),null!=n.cls&&$(t).toggleClass(n.cls,!1),null!=n.color&&null!=a&&r&&OPC.set_style(l,a,e,n.color,!0),null!=n.style&&r&&OPC.set_styles(l,e,n.style),null!=n.cls?$(t).toggleClass(n.cls,r):void 0)},t.set_attr=function(t,e,n,r,a){var l,i,s,o;return s=OPC.get_cache(t,e),i=$("#"+t,OPC.root_elem),o=this.parseBool(a),null==s&&(l=null!=(l=i.attr(n))?l:"",s=OPC.set_cache(t,e,l)),o?i.attr(n,r):null!=s?i.attr(n,s):i.attr(n,""),!0},t.parseBool=function(t){var e;return e=!1,null!=t&&(e="true"===$.trim(t.toString().toLowerCase())||!isNaN(t)&&parseFloat(t)>0),e},t}.call(this),OPC.Modal=function(){function t(e){var n,r,a,l,i,s,o,u,c,h,f,g=this;if(this.config=e,this.close=function(){return t.prototype.close.apply(g,arguments)},$("#opc-modal-overlay").length>0)return!1;for(this.overlay=$('<div id="opc-modal-overlay"></div>'),$("body").append(this.overlay),null==this.config.id&&(this.config.id="opc-modal"),a=null!=this.config.cls?this.config.cls:"",o="<input type='text' id='opc-modal-val' value='"+OPC.get_value(this.config.tag,this.config.prop)+"'/>",o=null!=this.config.contents?this.config.contents:o,u=null!=this.config.message?"<div class='opc-modal-message'>"+this.config.message+"</div>":"",i="    <div class='opc-modal-dialog "+a+"' id='"+this.config.id+"' style='display:none;'>       <div class='opc-modal-title' >"+this.config.title+"</div>       "+u+"       <div class='opc-modal-message' id='opc-modal-input' style='display:none;'>"+o+"</div>       <div class='opc-modal-buttons'></div>    </div>",this.isvalid=!0,this.dialog=$(i),$("body").append(this.dialog),null!=this.config.val&&$("#opc-modal-val").val(this.config.val),null==this.config.buttons&&(this.config.buttons=[],this.config.buttons.push({text:"OK"})),s=c=0,h=(f=this.config.buttons).length;c<h;s=++c)n=f[s],(l=this.dialog.find(".opc-modal-buttons")).append($("<button id='button_"+s+"'>"+n.text+"</button>")),r=l.find("#button_"+s),n.defer_close?r.click(n.click):r.click(function(t){var e,n,r,a,l,i;for(n=t.target.id,r=a=0,l=(i=g.config.buttons).length;a<l;r=++a)if(null!=(e=i[r]).click&&"button_"+r===n){if(null!=g.config.tag){if(!g.isvalid)return!1;e.click(g.config.tag,g.config.prop,$("#opc-modal-val").val())}else e.click(g);break}return g.close(),!0}),this.config.show_input&&($("#opc-modal-input").show(),null!=this.config.validation&&(o=$("#opc-modal-val"),"boolean"===this.config.validation&&o.keyup(function(t){var e;return e=$.trim(o.val().toString().toLowerCase()),g.isvalid="true"===e||"false"===e,o.toggleClass("invalid",!g.isvalid)})));$(window).resize(function(){return g.dialog.center()}),this.dialog.center(),this.overlay.fadeTo(200,.5),this.dialog.fadeTo(200,1)}return t.prototype.close=function(){return this.dialog.fadeTo(100,0,function(){return $(this).remove()}),this.overlay.fadeTo(100,0,function(){return $(this).remove()}),!0},t}(),OPC.TrendRequest=function(){return function(t,e,n){var r,a,l,i,s;for(this.token=OPC.token,this.requesttype=t.requesttype,this.chartinstanceguid=t.guid,this.samplerate=t.samplerate,this.timeframe=t.timeframe,this.tagnames=null!=e?e:[],this.historytagnames=null!=n?n:[],this.starthistorydate=t.starthistorydate,this.endhistorydate=t.endhistorydate,this.returnalldatawithtimes=null!=t.returnalldatawithtimes&&t.returnalldatawithtimes,this.historystatprocessing=[],l=0,i=(s=t.tags).length;l<i;l++)"string"==typeof(a=s[l])?this.historystatprocessing.push("avg"):"object"==typeof a&&null!=a.tag&&(r=null!=a.historystatprocessing?a.historystatprocessing:"avg",this.historystatprocessing.push(r))}}(),OPC.Trend=function(){function t(){}return t.getTrendBinding=function(t){var e,n,r,a;for(n=0,r=(a=OPC.trend_bindings).length;n<r;n++)if((e=a[n]).guid===t.chartinstanceguid)return e;return null},t.getHistoryData=function(t,e,n){return OPC.get_history_data(t,e,n)},t.resumeTrendData=function(t){return OPC.resume_trend_data(t)},t.get_binding=function(t){var e,n,r,a;if("string"!=typeof t)return t;for(n=0,r=(a=OPC.trend_bindings).length;n<r;n++)if(null!=(e=a[n]).chartid&&e.chartid===t)return e;return null},t.get_history_data=function(t,e,n){return e="string"==typeof e?new Date(e):e,n="string"==typeof n?new Date(n):n,null!=(t=OPC.Trend.get_binding(t))&&(t.mode="history",t.starthistorydate=e.getTime(),t.endhistorydate=n.getTime(),t.requesttype="HistoryRequest",t.trend_data=null!=t.trend_data?t.trend_data:t.data,t.trend_retain=null!=t.trend_retain?t.trend_retain:t.retain,t.retain=null,t.data=null,!0)},t.resume_trend_data=function(t){return null!=(t=OPC.Trend.get_binding(t))&&"history"===t.mode&&(t.mode="trend",t.guid=null,t.data=t.trend_data,t.retain=t.trend_retain,t.requesttype="RefreshData",delete t.starthistorydate,delete t.endhistorydate,delete t.trend_data,delete t.trend_retain,!0)},t.refresh_data=function(){var t,e,n,r;if(null==OPC.trend_bindings)return!1;for(e=0,n=(r=OPC.trend_bindings).length;e<n;e++)null==(t=r[e]).requesttype&&(t.requesttype=""),null!=t.guid?"HistoryRequest"!==t.requesttype&&"HistoryData"!==t.requesttype&&(t.requesttype="NewData"):t.guid="",null==t.mode&&(t.mode="trend"),OPC.Trend.get_data(t);return!0},t.get_data=function(t){var e,n,r,a,l,i,s,o,u;if(t.in_call)return!1;for(t.in_call=!0,n=[],e=[],l=0,i=(s=t.tags).length;l<i;l++)"string"==typeof(a=s[l])?(n.push(a),e.push("")):"object"==typeof a&&null!=a.tag&&(n.push(a.tag),null!=a.historytag?e.push(a.historytag):e.push(""));return 0!==n.length?(r=new OPC.TrendRequest(t,n,e),t.cid=OPC.callback_id++,OPC.get({url:"/gettrenddata",data:r,cid:t.cid,success:(u=t.cid,function(t,e){var n,r,a,l;for(r=0,a=(l=OPC.trend_bindings).length;r<a;r++)if((n=l[r]).cid===u){n.in_call=!1,n.guid=t.chartinstanceguid,"HistoryRequest"===n.requesttype||"HistoryData"===n.requesttype?n.requesttype="HistoryData":n.requesttype="NewData",null!=t.penvalues&&t.firsttime>0&&null!=n.callback&&(t.firsttime=new Date(t.firsttime),t.lasttime=new Date(t.lasttime),n.callback(t));break}return OPC.clean_callback(u),!0}),error:(o=t.cid,function(e){var n,r,a;for(n=0,r=(a=OPC.trend_bindings).length;n<r;n++)if((t=a[n]).cid===o){t.in_call=!1;break}return OPC.log("REFRESH ERROR: "+e.status+", "+e.statusText)})}),!0):void 0},t}(),OPC.Flot=function(){function t(){}return t.buildTrendData=function(t){var e,n,r,a,l,i,s,o,u,c,h,f,g,d,p,m,_,v,y,C,b;if(null===(r=OPC.Trend.getTrendBinding(t)))return null;for(t.matchingindex,p=t.lasttime.getTime()-t.firsttime.getTime(),u=0,t.numberofvalues>1&&(u=p/(t.numberofvalues-1)),s=[],e=t.timesforreturnalldata,h=_=0,y=(b=t.penvalues).length;_<y;h=++_){for(c=b[h],f=r.tags[h],null==r.data&&(r.data={}),d="","string"==typeof f?d=f:"object"==typeof f&&null!=f.tag&&(d=f.tag),null==r.data[d]&&(r.data[d]=[]),a=r.data[d],i={data:r.data[d]},null!=f.color&&(i.color=f.color),null!=f.label&&(i.label=f.label),null!=f.lines&&(i.lines=f.lines),null!=f.bars&&(i.bars=f.bars),null!=f.points&&(i.points=f.points),null!=f.xaxis&&(i.xaxis=f.xaxis),null!=f.yaxis&&(i.yaxis=f.yaxis),f.clickable&&(i.clickable=!0),f.hoverable&&(i.hoverable=!0),null!=f.shadowSize&&(i.shadowSize=f.shadowSize),f.hilightColor&&(i.hilightColor=f.hilightColor),null!=f.fill&&(null==i.lines&&(i.lines={}),i.lines.fill=f.fill),n=null!=e?e[h]:null,o=v=0,C=c.length;v<C;o=++v)m=c[o],null!=n&&0!==n[o]?l=new Date(n[o]):(g=o*u+t.firsttime.getTime(),l=new Date(g)),a.push([l,m]);null!=r.retain&&a.length>r.retain&&(a=a.slice(a.length-r.retain)),i.data=a,s.push(i)}return s},t}(),OPC.Alarm=function(){function t(){}return t.getAlarmBinding=function(t){var e,n,r,a;for(n=0,r=(a=OPC.alarm_bindings).length;n<r;n++)if((e=a[n]).guid===t.alarminstanceguid)return e;return null},t.refresh_data=function(){var t,e,n,r;if(null==OPC.alarm_bindings)return!1;for(e=0,n=(r=OPC.alarm_bindings).length;e<n;e++)null==(t=r[e]).requesttype&&(t.requesttype="RefreshAllData"),null==t.guid&&(t.guid=""),null==t.mode&&(t.mode="alarms"),OPC.Alarm.get_data(t);return!0},t.send_update=function(t,e,n,r,a){var l,i,s;return l={token:OPC.token,alarmid:e,networknode:n,requesttype:r},"Comment"===r&&(l.comment=a),t.cid=OPC.callback_id++,OPC.get({url:"/updatealarm",data:l,cid:t.cid,success:(s=t.cid,function(e,n){var r,a,l;for(r=0,a=(l=OPC.alarm_bindings).length;r<a;r++)if((t=l[r]).cid===s){t.in_call=!1;break}return!0}),error:(i=t.cid,function(e){var n,r,a;for(n=0,r=(a=OPC.alarm_bindings).length;n<r;n++)if((t=a[n]).cid===i){t.in_call=!1;break}return OPC.log("REFRESH ERROR: "+e.status+", "+e.statusText)})}),!0},t.get_history=function(t,e,n){return e=new Date(e),n=new Date(n),t.requesttype="HistoryRequest",t.starthistorydate=e.getTime(),t.endhistorydate=n.getTime(),t.doclear=!0},t.get_realtime=function(t){return t.requesttype="RefreshAllData",delete t.starthistorydate,delete t.endhistorydate,t.doclear=!0},t.get_data=function(t){var e,n,r;return!t.in_call&&(t.in_call=!0,e={networknodes:null!=t.networkNodes?t.networkNodes:[],alarmfilter:t.filter?t.filter:[],token:OPC.token,requesttype:t.requesttype,starthistorydate:t.starthistorydate,endhistorydate:t.endhistorydate,alarminstanceguid:t.guid},t.cid=OPC.callback_id++,OPC.get({url:"/getalarmdata",data:e,cid:t.cid,success:(r=t.cid,function(e,n){var a,l,i;for(a=0,l=(i=OPC.alarm_bindings).length;a<l;a++)if((t=i[a]).cid===r){t.guid=e.alarminstanceguid,t.doclear&&null!=t.requesttype&&""!==t.requesttype&&t.requesttype.indexOf("Data")>=0&&(t.data_table.fnClearTable(),t.doclear=!1),"HistoryRequest"===t.requesttype||"HistoryData"===t.requesttype?t.requesttype="HistoryData":t.requesttype="NewData",null!=e&&null!=e.alarmvalues&&t.update_data(e.alarmvalues),null!=t.callback&&t.callback(t,e),t.in_call=!1;break}return OPC.clean_callback(r),!0}),error:(n=t.cid,function(e){var r,a,l;for(r=0,a=(l=OPC.alarm_bindings).length;r<a;r++)if((t=l[r]).cid===n){t.in_call=!1;break}return OPC.log("REFRESH ERROR: "+e.status+", "+e.statusText)})}),!0)},t.init_alarms=function(){var t,e,n,r,a,l,i;for(n=[],a=0,l=(i=OPC.alarm_bindings).length;a<l;a++)t=i[a],null!=(r=$("#"+t.alarmid,OPC.root_elem))&&0!==r.length&&null!=r.dataTable&&(e=new OPC.Alarm.Binding(t),n.push(e));return OPC.alarm_bindings=n,n},t.data_order=["GroupBuffer","NetworkNode","AlarmID","AlarmType","Group","Priority","Text","Active","Acked","TimeDelay","AlarmValue","AlarmLimit","ClearedValue","AlarmDateTime","ClearedDateTime","AckedDateTime","AckedUser","Units","Document","Comment","OKToDelete","OKToComment"],t.data_idx=function(t){var e,n,r,a;for(e=n=0,r=(a=this.data_order).length;n<r;e=++n)if(a[e]===t)return e;return-1},t}(),OPC.Alarm.Binding=function(){function t(e){var n,r,a,l,i,s,o,u,c,h,f,g,d,p,m,_,v,y,C,b,O,P,k,w,x,$,A,T=this;if(this.grouphead_click=function(e){return t.prototype.grouphead_click.apply(T,arguments)},this.set_group_visibility=function(){return t.prototype.set_group_visibility.apply(T,arguments)},this.row_callback=function(e,n,r,a){return t.prototype.row_callback.apply(T,arguments)},this.alarmid=null!=e.alarmid?e.alarmid:"missing_alarmid",this.showProcessing=null==e.showProcessing||e.showProcessing,this.pagination=null!=e.pagination&&e.pagination,this.pageLength=null!=e.pageLength?e.pageLength:10,this.disableAlarmAckOnDoubleClick=null!=e.disableAlarmAckOnDoubleClick&&e.disableAlarmAckOnDoubleClick,this.showDelete=null==e.showDelete||e.showDelete,this.showComment=null!=e.showComment&&e.showComment,this.showSearch=null==e.showSearch||e.showSearch,this.showHistory=null!=e.showHistory&&e.showHistory,this.showInfo=!e.showInfo||e.showInfo,this.dateTimeFormat=e.dateTimeFormat?e.dateTimeFormat:"mm/dd/yyyy hh:MM aa",this.dateFormat=e.dateFormat?e.dateFormat:"mm/dd/yyyy",this.dateTimeHistorySelectionFormat=e.dateTimeHistorySelectionFormat?dateTimeHistorySelectionFormat:"MM/dd/yyyy HH:mm:ss",this.filter=OPC.Alarm.Binding.default_filter,null!=e.filter&&(null!=e.filter.includealarmactive&&(this.filter.includealarmactive=e.filter.includealarmactive),null!=e.filter.includealarmnotactive&&(this.filter.includealarmnotactive=e.filter.includealarmnotactive),null!=e.filter.includealarmactiveacked&&(this.filter.includealarmactiveacked=e.filter.includealarmactiveacked),null!=e.filter.includealarmnotactiveacked&&(this.filter.includealarmnotactiveacked=e.filter.includealarmnotactiveacked),null!=e.filter.includealarmnotactivenotacked&&(this.filter.includealarmnotactivenotacked=e.filter.includealarmnotactivenotacked),null!=e.filter.maxpriority&&(this.filter.maxpriority=e.filter.maxpriority),null!=e.filter.minpriority&&(this.filter.minpriority=e.filter.minpriority),null!=e.filter.alarmgroups&&(this.filter.alarmgroups=e.filter.alarmgroups),null!=e.filter.alarmtypes&&(this.filter.alarmtypes=e.filter.alarmtypes)),this.columns=OPC.Alarm.Binding.default_columns,null!=e.columns){for(this.columns=e.columns,c=!1,u=!1,o=!1,h=this.default_column_by_name("AlarmID"),r=this.default_column_by_name("Active"),n=this.default_column_by_name("Acked"),f=0,m=(k=this.columns).length;f<m;f++)for("alarmid"===(a=k[f]).name.toLowerCase()&&(c=!0),"active"===a.name.toLowerCase()&&(u=!0),"acked"===a.name.toLowerCase()&&(o=!0),g=0,_=(w=OPC.Alarm.Binding.default_columns).length;g<_;g++)if(i=w[g],a.name.toLowerCase()===i.name.toLowerCase()){a.name=i.name,a.text=null!=a.text?a.text:i.text,a.type=null!=a.type?a.type:i.type,a.visible=null==a.visible||a.visible,a.width=null!=a.width?a.width:i.width,a.align=null!=a.align?a.align:i.align,a.searchable=null!=a.searchable?a.searchable:i.searchable,a.sortable=null!=a.sortable?a.sortable:i.sortable;break}c||(h.visible=!1,this.columns.push(h)),u||(r.visible=!1,this.columns.push(r)),o||(n.visible=!1,this.columns.push(n))}for(d=0,v=(x=this.columns).length;d<v;d++)"OKToDelete"===(a=x[d]).name&&null==a.visible&&(a.visible=this.showDelete),"OKToComment"===a.name&&null==a.visible&&(a.visible=this.showComment);if(this.networkNodes=null!=e.networkNodes?e.networkNodes:[],this.callback=e.callback,this.rowClickCallback=e.rowClickCallback,this.height=e.height,this.group_exp={},this.grouping=null!=e.grouping&&e.grouping,this.groupingColumns=e.groupingColumns,null!=this.groupingColumns)for(l=this.groupingColumns.split(","),this.groupingColumns=[],p=0,y=l.length;p<y;p++)""!==(s=l[p]).trim()&&this.groupingColumns.push(s.trim());if(this.groupingColumns=null!=this.groupingColumns?this.groupingColumns:[],this.grouping&&this.groupingColumns.length>0)for(this.viscount=0,O=0,C=($=this.columns).length;O<C;O++){for("GroupBuffer"===(e=$[O]).name&&(e.visible=!0),P=0,b=(A=this.groupingColumns).length;P<b;P++)if(s=A[P],e.name===s){e.visible=!1;break}e.visible&&(this.viscount+=1)}this.backlog=[],this.updating=!0,this.draw_table()}return t.default_font={"font-family":"Helvetica, Arial, sans-serif","font-size":"12px","font-weight":"normal"},t.default_font_bold={"font-family":t.default_font["font-family"],"font-size":t.default_font["font-size"],"font-weight":"bold"},t.default_filter={includealarmactive:!0,includealarmnotactive:!0,includealarmactiveacked:!0,includealarmnotactiveacked:!1,includealarmnotactivenotacked:!0,maxpriority:1e6,minpriority:0,alarmgroups:[],alarmtypes:["Digital","High","High High","Low","Low Low","Operator Event","ROC","System","Tag Event"]},t.default_columns=[{name:"GroupBuffer",text:"",type:"string",visible:!1},{name:"AlarmID",text:"Alarm ID",type:"string",visible:!1},{name:"AlarmDateTime",text:"Alarm Date/Time",type:"datetime",visible:!0,sort:"desc",width:"130px",searchable:!1},{name:"Active",text:"Active",type:"boolean",visible:!0,width:"50px",align:"center"},{name:"AlarmValue",text:"Alarm Value",type:"string",visible:!0,align:"right"},{name:"Text",text:"Text",type:"string",visible:!0},{name:"AlarmType",text:"Alarm Type",type:"string",visible:!0},{name:"Group",text:"Group",type:"string",visible:!0},{name:"Priority",text:"Priority",type:"string",visible:!0,width:"50px",align:"right"},{name:"AckedDateTime",text:"Acked Date/Time",type:"datetime",visible:!0},{name:"Acked",text:"Acked",type:"boolean",visible:!0},{name:"AckedUser",text:"Acked User",type:"string",visible:!1},{name:"ClearedDateTime",text:"Cleared Date/Time",type:"datetime",visible:!1},{name:"ClearedValue",text:"Cleared Value",type:"string",visible:!1},{name:"NetworkNode",text:"Network Node",type:"string",visible:!1},{name:"Units",text:"Units",type:"string",visible:!1},{name:"TimeDelay",text:"Delay Time",type:"string",visible:!1},{name:"Document",text:"Document",type:"string",width:"50px",align:"center",visible:!1,searchable:!1,sortable:!1},{name:"Comment",text:"",type:"string",visible:!1,searchable:!1,sortable:!1},{name:"OKToComment",text:"Comment",type:"string",width:"50px",align:"center",searchable:!1,sortable:!1},{name:"OKToDelete",text:"Delete",type:"string",width:"50px",align:"center",searchable:!1,sortable:!1}],t.prototype.default_column_by_name=function(t){var e,n,r,a;for(n=0,r=(a=OPC.Alarm.Binding.default_columns).length;n<r;n++)if(e=a[n],t.toLowerCase()===e.name.toLowerCase())return e;return null},t.prototype.draw_table=function(){var t,e,n,r,a,l,i,s,o,u,c,h,f,g,d,p=this;if(this.container=$("#"+this.alarmid,OPC.root_elem),null==this.container||0===this.container.length)return OPC.log("Missing alarm container #"+this.alarmid),!1;for(this.container.empty(),this.table=$("<table id='"+this.alarmid+"_tbl' width='100%' class='opc-alarm'></table>"),this.container.append(this.table),null==this.columns&&(this.columns=[]),a=[],o=[],e=u=0,h=(g=this.columns).length;u<h;e=++u)t={sTitle:null!=(r=g[e]).text?r.text:r.name,bVisible:r.visible,bSortable:null==r.sortable||r.sortable,bSearchable:null==r.searchable||r.searchable,sWidth:null!=r.width?r.width:null},n="",null!=r.align&&(n+=" "+r.align),""!==n&&(t.sClass=n),a.push(t),null!=r.sort&&o.push([e,r.sort]);if(l={fnRowCallback:this.row_callback,aaSorting:o,aoColumns:a,bScrollCollapse:!0,iDisplayLength:this.pageLength,bPaginate:this.pagination,bProcessing:this.showProcessing,bAutoWidth:!1,bFilter:null!=this.showSearch&&this.showSearch,bInfo:null!=this.showInfo&&this.showInfo},this.grouping&&this.groupingColumns.length>0){for(s=[],c=0,f=(d=this.groupingColumns).length;c<f;c++)i=d[c],e=this.column_idx(i),s.push([e,"asc"]);l.order=s}return null!=this.height&&(l.sScrollY=this.height,l.bPaginate=!1,l.bScrollCollapse=!0),this.data_table=this.table.dataTable(l),this.showHistory&&(this.history_container=$("<div class='history-container'><span class='history-label'>Alarm History Start:</span></div>"),$(this.data_table).parent().prepend(this.history_container),this.history_start=$("<input type='text' id='history_start' placeholder='mm/dd/yyyy hh:mm am/pm'></input>"),this.history_end=$("<input type='text' id='history_end' placeholder='mm/dd/yyyy hh:mm am/pm'></input>"),this.history_go=$("<button id='history_go'>GO</button>"),this.history_container.append(this.history_start),this.history_container.append($("<span class='history-label'>End:</span> ")),this.history_container.append(this.history_end),this.history_container.append(this.history_go),this.history_go.click(function(t){var e,n;return p.history_go.hasClass("history")?(p.history_go.removeClass("history"),$("input[type=text], span",p.history_container).show(),p.history_go.html("GO"),OPC.Alarm.get_realtime(p)):(p.history_start.removeClass("err"),p.history_end.removeClass("err"),n=Date.parse(p.history_start.val()),e=Date.parse(p.history_end.val()),isNaN(n)?p.history_start.addClass("err"):n=new Date(n),isNaN(e)?p.history_end.addClass("err"):e=new Date(e),p.history_start.hasClass("err")||p.history_end.hasClass("err")?void 0:(p.history_go.addClass("history"),$("input[type=text], span",p.history_container).hide(),p.history_go.html("Resume Real Time Alarms"),OPC.Alarm.get_history(p,p.history_start.val(),p.history_end.val())))})),this},t.prototype.row_callback=function(t,e,n,r){var a,l,i,s,o,u,c,h,f,g,d,p,m,_,v,y,C;for(l="active",e[this.column_idx("Active")]||(l="not-"+l),e[this.column_idx("Acked")]&&(l+="-acked"),"Tag Event"===(m=e[this.column_idx("AlarmType")])&&(l="tag-event"),"Operator Event"===m&&(l="operator-event"),$(t).removeClass("active").removeClass("not-active").removeClass("active-acked").removeClass("not-active-acked"),$(t).removeClass("operator-event").removeClass("tag-event"),$(t).addClass(l),f=0,g=null!=(g=e[this.column_idx("OKToComment")])&&"true"===g.toLowerCase(),d=null!=(d=e[this.column_idx("OKToDelete")])&&"true"===d.toLowerCase(),v=0,y=(C=this.columns).length;v<y;v++)(a=C[v]).visible&&(_=e[this.column_idx(a.name)],"boolean"===a.type?(o=_?"fa-check-square-o":"fa-square-o",$("td:eq("+f+")",t).html("<i class='fa "+o+"'></i>")):"datetime"!==a.type&&"date"!==a.type||(p="",o="",u="datetime"===a.type?this.dateTimeFormat:this.dateFormat,null!=_&&""!==_&&(p=_.getTime(),o=OPC.Util.formatDate(_,u)),$("td:eq("+f+")",t).html("<span class='hide'>"+p+"</span>"+o)),"Document"===a.name?(c=null!=_?_:"#",h=null!=_&&""!==_?"file-o":"",$("td:eq("+f+")",t).html("<a href='"+c+"' target='_blank'><i class='fa fa-"+h+"'></i></a>")):"OKToComment"===a.name?(i=g?"":"disabled",h=null!=_&&""!==_?"comment":"comment-o",$("td:eq("+f+")",t).html("<a href='#' title='View/Edit Alarm Comments' class='comment-row "+i+"'><i class='fa fa-"+h+" "+i+"'></i></a>")):"OKToDelete"===a.name?(s=d?"":"disabled",$("td:eq("+f+")",t).html("<a href='#' title='Delete Alarm' class='delete-row "+s+"'><i class='fa fa-times-circle "+s+"'></i></a>"),$("td:eq("+f+")",t).attr("title","Delete Alarm")):$("td:eq("+f+")",t).attr("title",_),f++);return t},t.prototype.rearrange_data_row=function(t){var e,n,r,a,l,i,s;for(r=new Array(this.columns.length),n=l=0,i=(s=OPC.Alarm.data_order).length;l<i;n=++l)e=s[n],(a=this.column_idx(e))>=0&&(r[a]=t[n]);return this.convert_data_row(r)},t.prototype.convert_data_row=function(t){var e,n,r,a,l,i;for(n=a=0,l=(i=this.columns).length;a<l;n=++a)"boolean"===(e=i[n]).type&&(r="true"===(r=null!=t[n]&&""!==t[n]&&t[n].toLowerCase()),t[n]=r),"datetime"===e.type&&(r=null!=t[n]&&""!==t[n]?t[n].toLowerCase():0,""!==(r=new Date(parseInt(r)))&&r.getTime()<=0&&(r=""),t[n]=r);return t},t.prototype.set_updating=function(t){var e,n,r,a;if(this.updating===t)return!1;if(this.updating=t,t){for(n=0,r=(a=this.backlog).length;n<r;n++)e=a[n],this.update_data(e);return this.backlog=[]}},t.prototype.set_group_visibility=function(){var t,e,n,r,a,l,i,s,o,u,c,h,f,g;if(this.grouping&&!(this.groupingColumns.length<=0)){for(g=[],l=f=12;f>=1;l=--f)o=$("tr.group_row.lvl"+l,this.data_table),g.push(function(){var f,g,d,p,m;for(m=[],f=0,d=o.length;f<d;f++){if(s=o[f],a=this.get_groupid(s),e=!0,a)for(e=null==this.group_exp[a]||this.group_exp[a],i=$(s).next();i&&i.attr("class");){for(c=i.attr("class").split(" "),h=l+1,g=0,p=c.length;g<p;g++)if(0===(t=c[g]).indexOf("lvl")){h=parseInt(t.replace("lvl",""));break}if(h<=l)break;$(i).toggle(e),i=i.next()}u=e?"minus-square-o":"plus-square-o",$(s).find("span.exp_state").html("<i class='fa fa-"+u+"'></i>"),m.push(function(){var t;for(r in t=[],this.group_exp)this.group_exp[r]?t.push(void 0):(n=r.replace("grouphead-",""),t.push($("tr.group-"+n).hide()));return t}.call(this))}return m}.call(this));return g}},t.prototype.get_groupid=function(t){var e,n,r,a,l;for(r=null,a=0,l=(n=$(t).attr("class").split(" ")).length;a<l;a++)if(0===(e=n[a]).indexOf("grouphead-")){r=e;break}return r},t.prototype.grouphead_click=function(t){var e,n,r,a;return r=$(t.target),a=$(r).closest("tr"),n=this.get_groupid(a),null==(e=this.group_exp[n])&&(e=!0),this.group_exp[n]=!e,this.set_group_visibility(),this},t.prototype.render_groups=function(){var t,e,n,r,a,l,i,s,o,u,c,h,f,g,d,p,m,_,v,y,C,b,O,P;if(this.grouping&&this.groupingColumns.length>0){for(i=0,m=(t=this.data_table.api()).rows({page:"current"}).nodes(),d=null,y=0,b=(P=this.groupingColumns).length;y<b;y++){for(a=P[y],i+=1,p=d?this.column_idx(d):0,l=this.column_idx(a),g=d?t.column(p,{page:"current"}).data():null,r=t.column(l,{page:"current"}).data(),n=this.columns[l],f=g?this.columns[p]:null,c=null,u=C=0,O=r.length;C<O;u=++C)s=r[u],"boolean"===n.type&&(s=s?"True":"False"),e=((o=g?g[u]+"-"+s:s)+"").replace(/\W/g,""),h=g?f.name+"-"+n.name:n.name,o!==c&&("-",_=$("<td colspan='"+(this.viscount+1)+"'><span class='exp_state'>-</span> "+n.text+": "+s+"</td>"),(v=$("<tr class='group_row lvl"+i+" grouphead-"+h+"-"+e+"'></tr>")).append(_),_.click(this.grouphead_click),$(m).eq(u).before(v)),$(m).eq(u).addClass("group-"+h+"-"+e),c=o;d=a}return $("tr.odd td:first-child, tr.even td:first-child").addClass("lvl"+this.groupingColumns.length).addClass("group-buffer"),this.set_group_visibility()}},t.prototype.update_data=function(t){var e,n,r,a,l,i,s,o,u,c,h,f,g,d,p,m,_;if(null==t||0===t.length)return!1;if(s=this.column_idx("AlarmID"),l=OPC.Alarm.data_idx("AlarmID"),!this.updating)return this.backlog.push(t),!1;for(f=0,p=t.length;f<p;f++)t[f].splice(0,0,"");for(e=this.data_table.fnGetData(),g=0,m=t.length;g<m;g++){for(a=(r=t[g])[l],c=r[OPC.Alarm.data_idx("Text")],i=!this.check_filters(r)||"DELETEALARM"===c,o=this.rearrange_data_row(r),h=!1,u=null,null,n=d=0,_=e.length;d<_;n=++d)if(e[n][s]===a){h=!0,i?u=n:n;break}null!=u?(this.data_table.fnDeleteRow(u),e=this.data_table.fnGetData()):h?this.data_table.fnUpdate(o,n):i||this.data_table.fnAddData([o])}return this.set_handlers(),this.render_groups(),null!=this.callback&&this.callback(this,t),this},t.prototype.check_filters=function(t){var e,n,r,a;return this.column_idx("AlarmID"),OPC.Alarm.data_idx("AlarmID"),n="True"===t[OPC.Alarm.data_idx("Active")],e="True"===t[OPC.Alarm.data_idx("Acked")],r=null!=(r=t[OPC.Alarm.data_idx("Priority")])&&""!==r?parseInt(r):0,a=!0,null!=this.filter.includealarmactive&&n&&!e&&(a=a&&this.filter.includealarmactive&&n&&!e),null!=this.filter.includealarmactiveacked&&n&&e&&(a=a&&this.filter.includealarmactiveacked&&n&&e),null!=this.filter.includealarmnotactive&&!n&&!e&&(a=a&&this.filter.includealarmnotactive&&!n&&!e),null!=this.filter.includealarmnotactiveacked&&!n&&e&&(a=a&&this.filter.includealarmnotactiveacked&&!n&&e),a=(a=a&&r<=this.filter.maxpriority)&&r>=this.filter.minpriority},t.prototype.set_handlers=function(){var t;return t=this,$("tbody tr").off("click"),$("tbody tr").on("click",function(e){var n,r,a,l;if(null==this.clicks&&(this.clicks=0),r=t.data_table.fnGetPosition(this),n=t.data_table.fnGetData(r),a=t.alarm_id(n),l=t.network_node(n),++this.clicks,2===this.clicks)this.clicks=0,document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),OPC.Alarm.send_update(t,a,l,"Ack"),null!=t.rowClickCallback&&t.rowClickCallback(n,!0);else if(1===this.clicks){var i=n,s=this;setTimeout(function(){var e=s.clicks>1;return null!=t.rowClickCallback&&s.clicks>0&&t.rowClickCallback(i,e),s.clicks=0,!0},400)}}),$("a.comment-row",this.table).off("click"),$("a.comment-row",this.table).click(function(e){var n,r,a,l,i,s,o,u,c;return!$(e.target).hasClass("disabled")&&(!(!(c=$(this).closest("tr"))||0===c.length)&&(r=t.data_table.fnGetPosition(c[0]),n=t.data_table.fnGetData(r),a=t.alarm_id(n),u=t.network_node(n),s="true"===(s=t.value_for(n,"OKToComment")).toLowerCase(),i="               <label>Current comments on this Alarm:</label>              <div class='old-comments'>"+t.value_for(n,"Comment")+"</div>           ",l=[{text:"CANCEL"}],s&&(i+="<label>Add new comment(s):</label><textarea class='new-comment'></textarea>",l.push({text:"SAVE",click:function(e){var n;if(""!==(n=$("textarea.new-comment",e.dialog).val().trim()))return OPC.Alarm.send_update(t,a,u,"Comment",n)}})),o={title:"View/Add Alarm Comments",show_input:!0,cls:"comment-dialog",contents:i,buttons:l},new OPC.Modal(o),!1))}),$("a.delete-row",this.table).off("click"),$("a.delete-row",this.table).click(function(e){var n,r,a,l,i;return!$(e.target).hasClass("disabled")&&(!(!(i=$(this).closest("tr"))||0===i.length)&&(r=t.data_table.fnGetPosition(i[0]),n=t.data_table.fnGetData(r),a=t.alarm_id(n),l=t.network_node(n),OPC.Alarm.send_update(t,a,l,"Delete"),t.data_table.fnDeleteRow(r),t.render_groups(),!1))})},t.prototype.column_idx=function(t){var e,n,r,a;for(e=n=0,r=(a=this.columns).length;n<r;e=++n)if(a[e].name===t)return e;return-1},t.prototype.value_for=function(t,e){return t[this.column_idx(e)]},t.prototype.alarm_id=function(t){return this.value_for(t,"AlarmID")},t.prototype.network_node=function(t){return this.value_for(t,"NetworkNode")},t}()}.call(this);